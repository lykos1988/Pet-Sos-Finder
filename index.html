<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Pet SOS Finder</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#28a745">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
<style>
/* === Î¤Î¿ Î´Î¹ÎºÏŒ ÏƒÎ¿Ï… CSS Ï‡Ï‰ÏÎ¯Ï‚ Î±Î»Î»Î±Î³Î­Ï‚ === */
:root{
  --green:#28a745;
  --blue:#1e88e5;
  --bg:#f5f7fb;
  --card:#ffffff;
  --muted:#6b7280;
}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Poppins',sans-serif;background:var(--bg);color:#222;display:flex;justify-content:center;align-items:center;min-height:100vh;}
.app{width:100%;height:100vh;max-width:500px;background:#fff;display:flex;flex-direction:column;overflow:hidden;}
.topbar{background:var(--green);color:white;padding:18px 16px;display:flex;align-items:center;gap:12px;justify-content:space-between;}
.logo{width:42px;height:42px;background:rgba(255,255,255,0.15);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:bold;}
.title{font-size:16px;font-weight:700;line-height:1.2;}
.content{flex:1;overflow-y:auto;padding:16px;background:var(--bg);}
.home-card{background:var(--card);border-radius:20px;padding:20px;text-align:center;box-shadow:0 4px 12px rgba(0,0,0,0.05);}
.illu{font-size:48px;margin-bottom:8px;}
h1.appname{font-size:20px;margin-bottom:4px;}
p.small{font-size:13px;color:var(--muted);margin-bottom:14px;}
.btn{display:block;width:100%;padding:12px;border:none;border-radius:12px;font-size:15px;font-weight:bold;margin-bottom:10px;cursor:pointer;}
.btn-report{background:var(--green);color:white;}
.btn-found{background:var(--blue);color:white;}
.btn-view{background:white;border:1px solid var(--green);color:var(--green);}
.card{background:var(--card);border-radius:20px;padding:16px;box-shadow:0 4px 12px rgba(0,0,0,0.05);}
form .row{margin-bottom:12px;text-align:left;}
label{display:block;font-weight:bold;margin-bottom:6px;font-size:13px;}
input,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #ddd;font-size:14px;}
textarea{min-height:80px;resize:vertical;}
.photo-preview{width:100%;height:150px;background:#f0f0f0;border-radius:10px;display:flex;align-items:center;justify-content:center;overflow:hidden;margin-top:6px;}
.photo-preview img{width:100%;height:100%;object-fit:cover;}
.success-screen{text-align:center;padding:20px;}
.check{width:80px;height:80px;background:#e7f7ed;border-radius:50%;display:flex;align-items:center;justify-content:center;color:var(--green);font-size:40px;margin:0 auto 14px;}
.reports-list{display:flex;flex-direction:column;gap:12px;}
.report-card{background:var(--card);border-radius:14px;padding:12px;box-shadow:0 4px 10px rgba(0,0,0,0.05);}
.thumb{width:100%;max-height:300px;border-radius:10px;background:#f0f0f0;overflow:hidden;}
.thumb img{width:100%;height:100%;object-fit:cover;display:block;}
.meta{text-align:center;margin-top:10px;}
.meta h3{font-size:15px;margin-bottom:4px;}
.meta p{font-size:13px;color:var(--muted);}
.comments{margin-top:10px;border-top:1px solid #eee;padding-top:8px;}
.comment{background:#f9f9f9;padding:8px;border-radius:8px;font-size:13px;margin-bottom:6px;}
.add-comment{display:flex;gap:6px;}
.add-comment input{flex:1;padding:8px;border-radius:8px;border:1px solid #ddd;}
.add-comment button{padding:8px;border-radius:8px;border:none;background:var(--green);color:white;cursor:pointer;}
footer{background:#f0f0f0;padding:10px;font-size:12px;color:#444;text-align:center;}
footer a{color:var(--green);text-decoration:none;margin:0 5px;cursor:pointer;}
.popup-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;z-index:999;}
.popup{background:white;padding:20px;border-radius:10px;max-width:400px;width:90%;text-align:center;}
.popup h2{margin-bottom:10px;font-size:18px;}
.popup button{background:var(--green);color:white;border:none;padding:8px 12px;border-radius:8px;margin-top:10px;cursor:pointer;}
.phone-section{display:flex;flex-direction:column;align-items:center;}
.phone-title{font-size:11px;opacity:0.9;margin-bottom:4px;text-align:center;}
.phone-badge{display:flex;align-items:center;justify-content:center;border:2px solid white;border-radius:50px;padding:4px 10px;font-weight:bold;font-size:14px;background:rgba(255,255,255,0.15);cursor:pointer;}
.bottom-image{width:100%;height:200px;background:url('https://i.postimg.cc/pXQGYtdf/file-000000005a0461f7ac070060328b7622-removebg-preview.png') no-repeat center bottom;background-size:contain;background-color:var(--bg);}
#filterSelect{width:100%;padding:12px;border:1px solid var(--green);border-radius:12px;background:white;color:var(--green);font-size:15px;font-weight:bold;cursor:pointer;appearance:none;text-align:center;box-shadow:0 4px 12px rgba(0,0,0,0.05);}
#filterSelect:focus{outline:none;border-color:var(--green);}
</style>
</head>
<body>
<div class="app">
  <div class="topbar">
    <div class="logo"><img src="https://i.postimg.cc/BQgxhZfC/file-00000000f46c61f7aad70d3141366646-removebg-preview.png" alt="" width="80" height="80"></div>
    <div><div class="title">Pet SOS Finder</div><div style="font-size:12px;opacity:0.9">Î’ÏÎµÏ‚ Î® Î±Î½Î­Ï†ÎµÏÎµ ÎºÎ±Ï„Î¿Î¹ÎºÎ¯Î´Î¹Î¿</div></div>
    <div class="phone-section"><div class="phone-title">Î¤Î·Î»Î­Ï†Ï‰Î½Î¿ ÎºÎ±ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Î¶ÏÏ‰Î½</div><div class="phone-badge">ğŸ“ 10410</div></div>
  </div>
  <div class="content" id="mainContent">
    <!-- HOME -->
    <section id="homeView">
      <div class="home-card">
        <div class="illu">ğŸ¾ğŸ±</div>
        <h1 class="appname">PET SOS FINDER</h1>
        <p class="small">Î‘Î½Î±Ï†Î­ÏÎµÏ„Îµ Î±Î½ Ï‡Î¬Î¸Î·ÎºÎµ Î® Î²ÏÎ­Î¸Î·ÎºÎµ ÎºÎ±Ï„Î¿Î¹ÎºÎ¯Î´Î¹Î¿ â€” Î® Î´ÎµÎ¯Ï„Îµ Ï„Î¹Ï‚ Î±Î½Î±Ï†Î¿ÏÎ­Ï‚ Î¬Î»Î»Ï‰Î½.</p>
        <button class="btn btn-report" onclick="openForm('lost')">Î‘Î½Î±Ï†Î¿ÏÎ¬ ÏŒÏ„Î¹ Ï‡Î¬Î¸Î·ÎºÎµ ÎºÎ±Ï„Î¿Î¹ÎºÎ¯Î´Î¹Î¿</button>
        <button class="btn btn-found" onclick="openForm('found')">Î‘Î½Î±Ï†Î¿ÏÎ¬ ÏŒÏ„Î¹ Î²ÏÎ­Î¸Î·ÎºÎµ ÎºÎ±Ï„Î¿Î¹ÎºÎ¯Î´Î¹Î¿</button>
        <button class="btn btn-view" onclick="showReports()">Î ÏÎ¿Î²Î¿Î»Î® Î±Î½Î±Ï†Î¿ÏÏÎ½</button>
      </div>
      <div class="bottom-image"></div>
    </section>
    <!-- FORM -->
    <section id="formView" style="display:none;">
      <div class="card">
        <form id="reportForm" onsubmit="return submitReport(event)">
          <div class="row"><label id="nameLabel">ÎŒÎ½Î¿Î¼Î± ÎºÎ±Ï„Î¿Î¹ÎºÎ¹Î´Î¯Î¿Ï…</label><input type="text" id="petName" required></div>
          <div class="row"><label>Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®</label><textarea id="petDesc" required></textarea></div>
          <div class="row"><label>Î¤Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±</label><input type="text" id="petLoc" required></div>
          <div class="row"><label>Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚</label><input type="text" id="petContact" required></div>
          <div class="row"><label>Î¦Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î±</label><input type="file" accept="image/*" id="petPhoto"><div class="photo-preview" id="photoPreview">Î ÏÎ¿ÎµÏ€Î¹ÏƒÎºÏŒÏ€Î·ÏƒÎ·</div></div>
          <button class="btn btn-report" style="margin-top:12px;">Î‘Î½Î±Ï†Î¿ÏÎ¬</button>
          <button type="button" class="btn btn-view" onclick="backHome()">Î‘ÏÏ‡Î¹ÎºÎ®</button>
        </form>
      </div>
    </section>
    <!-- SUCCESS -->
    <section id="successView" style="display:none;">
      <div class="success-screen"><div class="check">âœ“</div><p>Î— Î±Î½Î±Ï†Î¿ÏÎ¬ ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ®Î¸Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!</p><button class="btn btn-view" onclick="showReports()">Î”ÎµÏ‚ Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚</button><button class="btn btn-report" style="margin-top:8px;" onclick="backHome()">Î‘ÏÏ‡Î¹ÎºÎ®</button></div>
    </section>
    <!-- REPORTS -->
    <section id="reportsView" style="display:none;">
      <div style="margin-bottom:12px; text-align:center;">
        <select id="filterSelect" onchange="showReports()"><option value="all">ÎŒÎ»ÎµÏ‚ Î¿Î¹ Î±Î½Î±Ï†Î¿ÏÎ­Ï‚</option><option value="lost">ÎœÏŒÎ½Î¿ Î§Î±Î¼Î­Î½Î±</option><option value="found">ÎœÏŒÎ½Î¿ Î’ÏÎµÎ¸Î­Î½Ï„Î±</option></select>
      </div>
      <div class="reports-list" id="reportsContainer"></div>
      <button class="btn btn-view" style="margin-top:10px;" onclick="backHome()">Î‘ÏÏ‡Î¹ÎºÎ®</button>
    </section>
  </div>
  <footer>Â© 2025 PET SOS FINDER â€“ Î£Ï‰Ï„Î®ÏÎ·Ï‚ Î”Î·Î¼Î·Ï„ÏÎ¯Î¿Ï…. ÎœÎµ ÎµÏ€Î¹Ï†ÏÎ»Î±Î¾Î· Ï€Î±Î½Ï„ÏŒÏ‚ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î¿Ï‚. | <a onclick="openPopup('contact')">Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±</a> | <a onclick="openPopup('about')">Î£Ï‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ</a></footer>
</div>

<div class="popup-overlay" id="popupOverlay"><div class="popup" id="popupContent"><h2 id="popupTitle"></h2><p id="popupText"></p><button onclick="closePopup()">ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿</button></div></div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = "https://wvpgrjykqzkolaczbcqr.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind2cGdyanlrcXprb2xhY3piY3FyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUwNzczMDYsImV4cCI6MjA3MDY1MzMwNn0.OyjI4flh86LTOXp8LaR04xhS7pkrTbZYy-62YU7ovJI";
const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

function openPopup(type){
  document.getElementById("popupOverlay").style.display = "flex";
  if(type === "contact"){
    document.getElementById("popupTitle").innerText = "Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±";
    document.getElementById("popupText").innerHTML = "Email: <b>sotiris.dimitriou.1988@gmail.com</b>";
  } else {
    document.getElementById("popupTitle").innerText = "Î£Ï‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ";
    document.getElementById("popupText").innerHTML = "Î Î»Î±Ï„Ï†ÏŒÏÎ¼Î± ÎµÏÏÎµÏƒÎ·Ï‚/Î±Î½Î±Ï†Î¿ÏÎ¬Ï‚ ÎºÎ±Ï„Î¿Î¹ÎºÎ¹Î´Î¯Ï‰Î½.";
  }
}
function closePopup(){ document.getElementById("popupOverlay").style.display = "none"; }
function openForm(type){ document.getElementById("homeView").style.display = "none"; document.getElementById("formView").style.display = "block"; document.getElementById("reportForm").dataset.type = type; document.getElementById("nameLabel").innerText = type==="found" ? "ÎŸÎ½Î¿Î¼Î±Ï„ÎµÏ€ÏÎ½Ï…Î¼Î¿" : "ÎŒÎ½Î¿Î¼Î± ÎºÎ±Ï„Î¿Î¹ÎºÎ¹Î´Î¯Î¿Ï…";}
function backHome(){ document.getElementById("homeView").style.display = "block"; document.getElementById("formView").style.display = "none"; document.getElementById("successView").style.display = "none"; document.getElementById("reportsView").style.display = "none"; }

document.getElementById("petPhoto").addEventListener("change", function(){
  const file = this.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = e => {
      document.getElementById("photoPreview").innerHTML = `<img src="${e.target.result}">`;
      document.getElementById("photoPreview").dataset.file = file;
    };
    reader.readAsDataURL(file);
  }
});

async function submitReport(e) {
  e.preventDefault();

  const type = e.target.dataset.type;
  const name = document.getElementById("petName").value;
  const description = document.getElementById("petDesc").value;
  const loc = document.getElementById("petLoc").value;
  const contact = document.getElementById("petContact").value;

  // Î Î±Î¯ÏÎ½Î¿Ï…Î¼Îµ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿
  const fileInput = document.getElementById("petPhoto");
  const file = fileInput.files[0];
  let photoUrl = "";

  if (file) {
    const fileExt = file.name.split('.').pop();
    const fileName = `${Date.now()}.${fileExt}`;

    // Î‘Î½ÎµÎ²Î¬Î¶Î¿Ï…Î¼Îµ ÏƒÏ„Î¿ Supabase Storage
    const { error: uploadError } = await supabaseClient
      .storage
      .from("pets")
      .upload(fileName, file);

    if (uploadError) {
      alert("Î£Ï†Î¬Î»Î¼Î± ÏƒÏ„Î¿ Î±Î½Î­Î²Î±ÏƒÎ¼Î± ÎµÎ¹ÎºÏŒÎ½Î±Ï‚");
      console.error(uploadError);
    } else {
      // Î Î±Î¯ÏÎ½Î¿Ï…Î¼Îµ Ï„Î¿ public URL
      const { data: publicData } = supabaseClient
        .storage
        .from("pets")
        .getPublicUrl(fileName);

      photoUrl = publicData.publicUrl;
    }
  }

  // ÎšÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ· ÏƒÏ„Î¿ Supabase
  const { error: insertError } = await supabaseClient
    .from("reports")
    .insert([{
      type,
      name,
      description,
      loc,
      contact,
      photo: photoUrl,
      comments: []
    }]);

  if (insertError) {
    alert("Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·Ï‚");
    console.error(insertError);
    return;
  }

  // ÎšÎ±Î¸Î±ÏÎ¯Î¶Î¿Ï…Î¼Îµ Ï„Î· Ï†ÏŒÏÎ¼Î±
  e.target.reset();
  document.getElementById("photoPreview").innerHTML = "Î ÏÎ¿ÎµÏ€Î¹ÏƒÎºÏŒÏ€Î·ÏƒÎ·";
  delete document.getElementById("photoPreview").dataset.image;

  // Î•Î¼Ï†Î±Î½Î¯Î¶Î¿Ï…Î¼Îµ Ï„Î¿ success view
  document.getElementById("formView").style.display = "none";
  document.getElementById("successView").style.display = "block";
}
function renderComments(comments){ if(!comments||comments.length===0) return "<p style='font-size:12px;color:gray;'>ÎšÎ±Î½Î­Î½Î± ÏƒÏ‡ÏŒÎ»Î¹Î¿</p>"; return comments.map(c=>`<div class="comment">${c}</div>`).join(""); }

async function showReports(){
  const container = document.getElementById("reportsContainer");
  container.innerHTML = "";
  const filter = document.getElementById("filterSelect")?.value || "all";
  let query = supabaseClient.from("reports").select("*").order("created_at",{ascending:false});
  if(filter!=="all") query = query.eq("type", filter);
  const { data: reports, error } = await query;
  if(error){ container.innerHTML = "Î£Ï†Î¬Î»Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚"; return; }
  if(reports.length===0){ container.innerHTML = "<p>Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î±Î½Î±Ï†Î¿ÏÎ­Ï‚</p>"; }
  reports.forEach(r=>{
    const statusText = r.type==="lost"?"Î§Î±Î¼Î­Î½Î¿":"Î’ÏÎ­Î¸Î·ÎºÎµ";
    const foundNote = r.type==="found" ? "<p style='color:green;font-weight:bold;'>âœ… Î’ÏÎ­Î¸Î·ÎºÎµ</p>" : "";
    const cleanedDesc = (r.desc||"").replace("ÎºÎ±Î¹ ÎµÏ€Î­ÏƒÏ„ÏÎµÏˆÎµ ÏƒÏ„Î¿Î½ Î¹Î´Î¹Î¿ÎºÏ„Î®Ï„Î· Ï„Î¿Ï…","").trim();
    const card = document.createElement("div");
    card.className="report-card";
    card.innerHTML = `
      <div><div class="thumb">${r.photo?`<img src="${r.photo}">`:""}</div>
      <div class="meta"><h3>${r.name} - ${statusText}</h3><p>${cleanedDesc}</p>${foundNote}<p style="font-size:12px;color:gray;">ğŸ“ ${r.loc}</p><p style="font-size:12px;color:#000;">ğŸ“ ${r.contact}</p></div></div>
      <div class="comments">${renderComments(r.comments)}</div>
      <div class="add-comment"><input type="text" id="inp_${r.id}" placeholder="Î£Ï‡ÏŒÎ»Î¹Î¿..."><button onclick="addComment(${r.id})">Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®
      </button></div>
    `;
    container.appendChild(card);
  });

  // Î•Î½Î±Î»Î»Î±Î³Î® Ï€ÏÎ¿Î²Î¿Î»ÏÎ½
  document.getElementById("homeView").style.display = "none";
  document.getElementById("formView").style.display = "none";
  document.getElementById("successView").style.display = "none";
  document.getElementById("reportsView").style.display = "block";
}

async function addComment(id) {
  const input = document.getElementById("inp_" + id);
  const text = input.value.trim();
  if (!text) return;

  // Î Î±Î¯ÏÎ½Î¿Ï…Î¼Îµ Ï„Î¿ report
  const { data: reports, error } = await supabaseClient
    .from("reports")
    .select("comments")
    .eq("id", id)
    .single();

  if (error || !reports) return;

  let updatedComments = reports.comments || [];
  updatedComments.push(text);

  // Î‘Î½ Ï„Î¿ ÏƒÏ‡ÏŒÎ»Î¹Î¿ Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ "Î²ÏÎ­Î¸Î·ÎºÎµ" â†’ Î´Î¹Î±Î³ÏÎ±Ï†Î® Î±Î½Î±Ï†Î¿ÏÎ¬Ï‚
  if (normalizeGreek(text).includes("Î²ÏÎµÎ¸Î·ÎºÎµ")) {
    if (confirm("Î•Î¯ÏƒÎ±Î¹ ÏƒÎ¯Î³Î¿Ï…ÏÎ¿Ï‚ ÏŒÏ„Î¹ Î¸Î­Î»ÎµÎ¹Ï‚ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÎ¹Ï‚ Ï„Î·Î½ Î±Î½Î±Ï†Î¿ÏÎ¬;")) {
      await supabaseClient.from("reports").delete().eq("id", id);
      showReports();
      return;
    }
  }

  await supabaseClient
    .from("reports")
    .update({ comments: updatedComments })
    .eq("id", id);

  showReports();
}

function normalizeGreek(text) {
  return text
    .toLowerCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "");
}

// Real-time ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ·
supabaseClient
  .channel("public:reports")
  .on(
    "postgres_changes",
    { event: "*", schema: "public", table: "reports" },
    () => {
      showReports();
    }
  )
  .subscribe();
</script>
</body>
</html>
